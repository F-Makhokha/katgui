<div layout="column" flex ng-controller="SensorListCtrl as vm" style="max-height: 100%; min-height: 100%">

    <div flex layout="row" style="margin: 16px; max-height: 100%; min-height: 100%">
        <div layout="column" style="min-width:138px;">
            <div layout="column" style="margin-bottom: 8px" ng-repeat="node in vm.nodes | orderBy:node track by $index">
                <md-toolbar class="md-whiteframe-z1 md-toolbar-tools-medium" layout="row" layout-align="center center">
                    <span>{{node}}</span>
                </md-toolbar>
                <div class="md-whiteframe-z1" style="overflow: auto">
                    <div ng-class="{'active-sensor-list-resource':vm.resourceSensorsBeingDisplayed === resource.name}"
                         ng-repeat="resource in vm.resourcesNames | filter:{'node':node} | orderBy:'name' track by $index"
                         style="position: relative">
                        <md-button class="resource-root-item" ng-click="vm.listResourceSensors(resource.name);">
                            {{resource.name}}
                        </md-button>
                    </div>
                </div>
            </div>
        </div>
        <div flex class="resource-sensors-list" layout="column" style="max-height: 100%; min-height: 100%">
            <md-toolbar class="md-whiteframe-z1" style=" min-height: 80px">
                <div layout="row" layout-align="start center" style="margin-left: 16px; margin-top: 16px">
                    <span flex>Sensors</span>
                    <md-checkbox class="md-primary" ng-model="vm.hideNominalSensors" ng-click="$event.stopPropagation()"
                                 md-theme="{{themePrimaryButtons}}" style="font-size: 16px;">
                        Hide Nominal Sensors
                    </md-checkbox>
                    <input class="fade-in search-input-box" type="search"
                           ng-model-options="{ debounce: 300 }" ng-model="vm.q" placeholder="Search Sensors..."/>
                </div>

                <div flex class="unselectable list-subheader-title" layout="row" layout-align="start center"
                     style="padding-left: 8px;">
                    <span class="subheader-text resource-sensor-name"
                          ng-click="vm.setSensorsOrderBy('name')">
                        <span>Name</span>
                        <span class="fa"
                              ng-class="{'fa-caret-up': vm.sensorsOrderBy.value === 'name' && !vm.sensorsOrderBy.reverse, 'fa-caret-down': vm.sensorsOrderBy.value === 'name' && vm.sensorsOrderBy.reverse}"
                              style="margin-right: 4px;"></span>
                    </span>
                    <span class="subheader-text resource-sensor-status-item" ng-click="vm.setSensorsOrderBy('status')">
                        <span>Status</span>
                        <span class="fa"
                              ng-class="{'fa-caret-up': vm.sensorsOrderBy.value === 'status' && !vm.sensorsOrderBy.reverse, 'fa-caret-down': vm.sensorsOrderBy.value === 'status' && vm.sensorsOrderBy.reverse}"
                              style="margin-right: 4px;"></span>
                    </span>
                    <span class="subheader-text resource-sensor-time-item"
                          ng-click="vm.setSensorsOrderBy('timestamp')">
                        <span>Timestamp</span>
                        <span class="fa"
                              ng-class="{'fa-caret-up': vm.sensorsOrderBy.value === 'timestamp' && !vm.sensorsOrderBy.reverse, 'fa-caret-down': vm.sensorsOrderBy.value === 'timestamp' && vm.sensorsOrderBy.reverse}"
                              style="margin-right: 4px;"></span>
                    </span>
                    <span class="subheader-text resource-sensor-time-item"
                          ng-click="vm.setSensorsOrderBy('received_timestamp')">
                        <span>Received Timestamp</span>
                        <span class="fa"
                              ng-class="{'fa-caret-up': vm.sensorsOrderBy.value === 'received_timestamp' && !vm.sensorsOrderBy.reverse, 'fa-caret-down': vm.sensorsOrderBy.value === 'received_timestamp' && vm.sensorsOrderBy.reverse}"
                              style="margin-right: 4px;"></span>
                    </span>
                    <span flex class="subheader-text"
                          ng-click="vm.setSensorsOrderBy('value')">
                        <span>Value</span>
                        <span class="fa"
                              ng-class="{'fa-caret-up': vm.sensorsOrderBy.value === 'value' && !vm.sensorsOrderBy.reverse, 'fa-caret-down': vm.sensorsOrderBy.value === 'value' && vm.sensorsOrderBy.reverse}"
                              style="margin-right: 4px;"></span>
                    </span>
                </div>
            </md-toolbar>
            <md-virtual-repeat-container flex style="padding: 8px; overflow: auto; min-height: 100%;" class="md-whiteframe-z1">
                <!--ng-if="!vm.hideNominalSensors || vm.hideNominalSensors && sensor.status !== 'nominal'"-->
                <div
                    md-virtual-repeat="sensor in sensors = (vm.sensorsToDisplay | filter:filterByNotNominal | regexSearch:vm.sensorsOrderByFields:vm.q | orderBy:vm.sensorsOrderBy.value:vm.sensorsOrderBy.reverse)"
                    layout="column">
                    <div title="{{sensor.description}}" class="resource-sensor-item"
                        layout="row" class="unselectable"
                        ng-click="vm.plotLiveSensorFeed(sensor, sensor.selectedForChart); sensor.selectedForChart = !sensor.selectedForChart;"
                        ng-class="{'selected-for-chart-row': sensor.selectedForChart}">
                        <span class="resource-sensor-name">{{sensor.name}}</span>
                        <span class="resource-sensor-status-item" ng-class="vm.sensorClass(sensor.status)">{{sensor.status}}</span>
                        <span class="resource-sensor-time-item">{{sensor.timestamp}}</span>
                        <span class="resource-sensor-time-item">{{sensor.received_timestamp}}</span>
                        <span flex class="resource-sensor-value-item">{{sensor.value}}</span>
                    </div>
                </div>
            </md-virtual-repeat-container>
        </div>
    </div>

    <div class="md-whiteframe-z5 sensor-list-chart-container" layout="column" ng-init="vm.showChart = false"
         inherit-body-bg target-color-inherit="md-content"
         ng-class="{'small-hidden-sensor-graph-container': !vm.showChart}">
        <md-toolbar class="md-whiteframe-z1" layout="row" layout-align="center center">
            <span draggable=".sensor-list-chart-container" flex style="margin-left: 8px; cursor: move;">
                Sensor Graph</span>
            <md-button ng-show="vm.showChart" md-theme="{{themePrimaryButtons}}"
                       class="md-icon-button inline-action-button" ng-click="vm.clearChartData()"
                       title="Clear Chart Data" style="margin: 0">
                <md-icon class="fa" md-font-icon="fa-eraser"></md-icon>
            </md-button>
            <md-button ng-show="vm.showChart" md-theme="{{themePrimaryButtons}}"
                       class="md-icon-button inline-action-button" ng-click="vm.maximiseSensorGraph()"
                       title="Maximise" style="margin: 0">
                <md-icon class="fa" md-font-icon="fa-expand"></md-icon>
            </md-button>
            <md-button ng-show="vm.showChart" md-theme="{{themePrimaryButtons}}"
                       class="md-icon-button inline-action-button" ng-click="vm.restoreSensorGraphSize()"
                       title="Restore Original Size" style="margin: 0">
                <md-icon class="fa" md-font-icon="fa-compress"></md-icon>
            </md-button>
            <md-button md-theme="{{themePrimaryButtons}}" class="md-icon-button inline-action-button"
                       ng-click="vm.showChart = !vm.showChart;"
                       title="Minimise Chart" style="margin: 0">
                <md-icon ng-show="vm.showChart" class="fa" md-font-icon="fa-chevron-down"></md-icon>
                <md-icon ng-show="!vm.showChart" class="fa" md-font-icon="fa-chevron-up"></md-icon>
            </md-button>
            <md-menu md-theme="{{themePrimaryButtons}}">
                <md-button class="md-icon-button inline-action-button" ng-click="$mdOpenMenu()"
                           style="margin-left: 0; margin-right: 8px;">
                    <md-icon class="fa" md-font-icon="fa-ellipsis-v"></md-icon>
                </md-button>
                <md-menu-content width="4" style="padding-left: 16px;">
                    <md-menu-item>
                        <md-checkbox class="md-primary" ng-model="vm.showGridLines" ng-change="vm.showOptionsChanged()"
                                     ng-click="$event.stopPropagation()">
                            Show Grid Lines
                        </md-checkbox>
                    </md-menu-item>
                    <md-menu-item>
                        <md-checkbox class="md-primary" ng-model="vm.showContextZoom"
                                     ng-change="vm.showOptionsChanged()" ng-click="$event.stopPropagation()">
                            Show Context Zoom
                        </md-checkbox>
                    </md-menu-item>
                    <md-menu-item>
                        <md-checkbox class="md-primary" ng-model="vm.useFixedYAxis" ng-change="vm.showOptionsChanged()"
                                     ng-click="$event.stopPropagation()">
                            Use Fixed Y Axis Values
                        </md-checkbox>
                    </md-menu-item>
                    <md-menu-item ng-if="vm.useFixedYAxis">
                        <div md-theme="{{themePrimaryButtons}}" layout="row" layout-align="start center" ng-click="$event.stopPropagation()"
                             style="margin-left: 8px; margin-right: 8px; margin-bottom: 8px;">
                            <label style="width: 43px; font-weight: normal; margin-top: 4px;">Y Min:</label>
                            <md-input-container md-no-float style="margin-left: 8px;text-align: start; padding: 0;"
                                                class="md-primary" title="Set the desired Y-Axis Minimum Value">
                                <input flex style="" placeholder="Minimum" ng-model="vm.yAxisMinValue"
                                       ng-change="vm.showOptionsChanged()" type="number"
                                       ng-model-options="{ debounce: 300 }">
                            </md-input-container>
                        </div>
                    </md-menu-item>
                    <md-menu-item ng-if="vm.useFixedYAxis">
                        <div md-theme="{{themePrimaryButtons}}" layout="row" layout-align="start center" ng-click="$event.stopPropagation()"
                             style="margin-left: 8px; margin-right: 8px; margin-bottom: 8px;">
                            <label style="width: 43px; font-weight: normal; margin-top: 4px;">Y Max:</label>
                            <md-input-container md-no-float style="margin-left: 8px;text-align: start; padding: 0;"
                                                class="md-primary" title="Set the desired Y-Axis Maximum Value">
                                <input flex style="" placeholder="Maximum" ng-model="vm.yAxisMaxValue"
                                       ng-change="vm.showOptionsChanged()" type="number"
                                       ng-model-options="{ debounce: 300 }">
                            </md-input-container>
                        </div>
                    </md-menu-item>
                </md-menu-content>
            </md-menu>
        </md-toolbar>
        <md-chips flex class="custom-chips" ng-model="vm.sensorsPlotNames" readonly="true">
            <md-chip-template title="{{$chip.name}}">
                <span class="{{$chip.class}}" style="font-size: 10px;">
                  <strong>{{$chip.name}}</strong>
                </span>
            </md-chip-template>
            <button md-chip-remove ng-click="vm.chipRemovePressed($chip)" class="md-primary sensor-name-chip">
                <md-icon md-font-icon="fa-close" class="fa"></md-icon>
            </button>
        </md-chips>
        <multi-line-chart ng-show="vm.showChart" flex redraw-function="vm.redrawChart" hide-context-zoom="true"
                          clear-function="vm.clearChart" class="sensor-list-multi-line-chart"
                          remove-sensor-function="vm.removeSensorLine" y-max="vm.yAxisMaxValue"
                          y-min="vm.yAxisMinValue" mouse-over-tooltip="true"></multi-line-chart>
        <div resizeable=".sensor-list-chart-container" class="resize-grip">
            <span flex class="fa fa-arrows-v"></span>
        </div>
    </div>
</div>
