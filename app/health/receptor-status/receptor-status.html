<div flex ng-controller="ReceptorStatusCtrl as vm" layout="column" layout-align="center"
     style="padding: 16px;" ng-class="{'connection-lost-bg':vm.connectionLost}">
    <md-checkbox md-theme="{{themePrimaryButtons}}" class="md-primary" ng-model="vm.sortBySubarrays"
        ng-mouseenter="vm.sortBySubarraysHover = true" ng-mouseleave="vm.sortBySubarraysHover = false"
        ng-class="{'opacity-50': !vm.sortBySubarraysHover}"
        style="position: absolute; top: -4px; right: 0;">
     Sort By Subarrays
    </md-checkbox>
    <md-checkbox md-theme="{{themePrimaryButtons}}" class="md-primary" ng-model="vm.showGraphics"
        ng-mouseenter="vm.showGraphicsHover = true" ng-mouseleave="vm.showGraphicsHover = false"
        ng-class="{'opacity-50': !vm.showGraphicsHover}"
        style="position: absolute; top: -4px; right: 160px;">
     Show Graphics
    </md-checkbox>
    <div flex style="padding: 16px">
        <div ng-show="!vm.sortBySubarrays" layout="column" style="text-align: center">
            <div ng-show="vm.showGraphics">
                <div ng-repeat="receptor in vm.receptorsData" class="md-whiteframe-z1" style="display: -webkit-inline-box; position: relative; margin: 2px;"
                    ng-class="{'receptor-graphic-sensors-nominal': receptor.sensors_ok.status === 'nominal', 'receptor-graphic-sensors-error': receptor.sensors_ok.status === 'error', 'receptor-graphic-stow': receptor.mode.value === 'STOW', 'receptor-graphic-stop': receptor.mode.value === 'STOP'}">
                    <div class="receptor-graphic-svg" ng-include="'images/receptor.svg'"></div>
                    <h2 class="receptor-graphic-name">{{receptor.name}}{{receptor.lock.value? '*' : ''}}</h2>
                    <div style="" class="receptor-graphic-labels" layout="column">
                        <span ng-class="{'stop-item': receptor.mode.value === 'STOP'}">{{receptor.windstow_active.value? '' : receptor.mode.value}}</span>
                        <span class="windstow-item">{{receptor.windstow_active.value? 'WINDSTOW' : ''}}</span>
                        <span class="inhibited-item">{{receptor.inhibited.value? 'INHIBITED' : ''}}</span>
                    </div>
                </div>
            </div>
            <div ng-show="!vm.showGraphics" flex style="margin: 4px">
                <div ng-repeat="receptor in vm.receptorsData track by $index"
                     class="receptor-status-block md-whiteframe-z1 unknown-item"
                     ng-class="receptor.sensors_ok ? receptor.sensors_ok.status + '-item' : 'unknown-item'">
                    <div>{{receptor.name}}<i style="font-size: 12px">{{(receptor.subarray !== 'free'? ' (' + receptor.subarray + ')' : '')}}</i></div>
                    <div title="AP on Target" ng-if="receptor.windstow_active.value === false" class="nominal-item" ng-class="{'stop-item': receptor.mode.value === 'STOP', 'stow-item': receptor.mode.value === 'STOW', 'error-item': receptor.windstow_active.value}">
                        <b>{{receptor.mode.value}}<span ng-show="receptor.lock.value" class="fa fa-asterisk"
                            title="AP on Target"></span></b>
                    </div>
                    <div ng-if="receptor.windstow_active.value" class="windstow-item"><b>WINDSTOW</b></div>
                    <div class="inhibited-item" ng-show="receptor.inhibited.value">INHIBITED</div>
                </div>
            </div>
        </div>

        <div ng-repeat="(key, subarray) in vm.subarrays | orderBy:'id'" ng-if="vm.sortBySubarrays"
             class="subarray-container md-whiteframe-z2" layout="row" layout-align="start"
             style="min-width: 650px;" flex>
            <div layout="column" layout-align="start" flex>
                <md-toolbar
                    md-theme="{{subarray.state === 'inactive'? 'grey' : subarray.state === 'active'? 'green' : subarray.state === 'error'? 'amber' : 'deep-purple'}}"
                    ng-class="{'md-hue-2': subarray.state !== 'inactive'}" class="md-whiteframe-z1"
                    layout="row" layout-align="center center" title="{{subarray.description}}"
                    style="max-height: 34px; min-height: 34px; position: relative;"
                    ng-click="$root.stateGoWithSubId('scheduler.observations.detail', vm.subarray_id)">
                    <span style="margin-left: 8px;">SUBARRAY {{subarray.id}} -
                        <span><b>{{subarray.state}}</b></span>
                        <span ng-if="subarray.maintenance">{{"- in maintenance"}}</span>
                    </span>
                    <span flex></span>

                    <div layout="row" layout-align="center center"
                         style="font-size: 12px;">
                        <span title="Control Authority" style="margin-right: 8px;"><i>CA: </i><b>{{subarray.delegated_ca}}</b></span>
                        <span title="Selected Band" style="margin-right: 8px;"><i>Band: </i><b>{{subarray.band ?
                            subarray.band : 'None'}}</b></span>
                        <span title="Selected Product" style="margin-right: 8px;"><i>Product: </i><b>{{subarray.product
                            ? subarray.product : 'None'}}</b></span>
                        <span ng-show="subarray.state === 'active' || subarray.config_label" style="margin-right: 8px;"
                              title="Config Label"><i>Config Label: </i><b>{{subarray.config_label ?
                            subarray.config_label : 'None'}}</b></span>
                    </div>
                </md-toolbar>
                <div ng-show="vm.showGraphics">
                    <div ng-repeat="receptor in vm.receptorsData" class="md-whiteframe-z1" style="display: -webkit-inline-box; position: relative; margin: 2px;"
                        ng-class="{'receptor-graphic-sensors-nominal': receptor.sensors_ok.status === 'nominal', 'receptor-graphic-sensors-error': receptor.sensors_ok.status === 'error', 'receptor-graphic-stow': receptor.mode.value === 'STOW', 'receptor-graphic-stop': receptor.mode.value === 'STOP'}">
                        <div class="receptor-graphic-svg" ng-include="'images/receptor.svg'"></div>
                        <h2 class="receptor-graphic-name">{{receptor.name}}{{receptor.lock.value? '*' : ''}}</h2>
                        <div style="" class="receptor-graphic-labels" layout="column">
                            <span ng-class="{'stop-item': receptor.mode.value === 'STOP'}">{{receptor.windstow_active.value? '' : receptor.mode.value}}</span>
                            <span class="windstow-item">{{receptor.windstow_active.value? 'WINDSTOW' : ''}}</span>
                            <span class="inhibited-item">{{receptor.inhibited.value? 'INHIBITED' : ''}}</span>
                        </div>
                    </div>
                </div>
                <div ng-show="!vm.showGraphics" flex style="padding: 4px; text-align: center" ng-class="{'maintenance-bg':subarray.maintenance}">
                    <div ng-repeat="receptor in vm.receptorsData | filter:{subarray:subarray.id} track by $index"
                         class="receptor-status-block md-whiteframe-z1"
                         ng-class="vm.getReceptorBlockClass(receptor)">
                        <div>{{receptor.name}}</div>
                        <div title="AP on Target" ng-if="receptor.windstow_active.value === false" class="nominal-item" ng-class="{'stop-item': receptor.mode.value === 'STOP', 'stow-item': receptor.mode.value === 'STOW', 'error-item': receptor.windstow_active.value}">
                            <b>{{receptor.mode.value}}<span ng-show="receptor.lock.value" class="fa fa-asterisk"
                                title="AP on Target"></span></b>
                        </div>
                        <div ng-if="receptor.windstow_active.value" class="windstow-item"><b>WINDSTOW</b></div>
                        <div class="inhibited-item" ng-show="receptor.inhibited.value">INHIBITED</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="legend-popup" style="background: transparent; pointer-events: none;" layout="row"
         ng-init="transparentLegend = true"
         ng-class="{'transparent-legend':transparentLegend && !showLegend}">
        <md-button flex style="pointer-events: auto;" md-theme="{{themePrimaryButtons}}" ng-init="showLegend = false" ng-click="showLegend = !showLegend"
                   ng-mouseenter="transparentLegend = false" ng-mouseleave="transparentLegend = true" class="md-fab md-mini md-primary">
            <md-icon class="fa center-md-icon" ng-if="!showLegend" md-font-icon="fa-eye"></md-icon>
            <md-icon class="fa center-md-icon" ng-if="showLegend" md-font-icon="fa-eye-slash"></md-icon>
        </md-button>
        <div class="md-whiteframe-z3" layout="column" ng-show="showLegend"
             style="background: white; padding: 8px;">
            <div layout="row" layout-align="start center">
                <div class="color-patch nominal-child" title="Green"></div>
                <span>Health - OK</span></div>
            <div layout="row" layout-align="start center">
                <div class="color-patch unknown-child" title="Grey"></div>
                <span>Mode - Stop</span></div>
            <div layout="row" layout-align="start center">
                <div class="color-patch warn-child" title="Amber"></div>
                <span>Mode - Inhibited</span></div>
            <div layout="row" layout-align="start center">
                <div class="color-patch stow-item" title="Blue"></div>
                <span>Mode - Stow</span></div>
            <div layout="row" layout-align="start center">
                <div class="color-patch in-assigned-subarray-item" title="Light Green"></div>
                <span>Assigned</span></div>
            <div layout="row" layout-align="start center">
                <div class="color-patch in-allocated-subarray-item" title="Light Blue"></div>
                <span>Allocated</span></div>
            <div layout="row" layout-align="start center">
                <div class="color-patch in-maintenance-item" title="Purple"></div>
                <span>In Maintenance</span></div>
            <div layout="row" layout-align="start center">
                <div class="color-patch error-item" title="Red"></div>
                <span>In Error</span></div>
            <div layout="row" layout-align="start center">
                <div class="color-patch amber-item" title="Amber"></div>
                <span>Subarray Active</span></div>
            <div layout="row" layout-align="start center">
                <div class="color-patch in-maintenance-item" title="Purple"></div>
                <span>Subarray In Maintenance</span></div>
            <div layout="row" layout-align="start center">
                <div class="color-patch nominal-item" title="Green"></div>
                <span>Subarray Inactive</span></div>
            <div layout="row" layout-align="start center">
                <div style="border: 1px solid #d3d3d3" class="color-patch" title="White"></div>
                <span>Nothing to Report</span></div>
        </div>
    </div>
</div>
