<div flex ng-controller="ReceptorStatusCtrl as vm" layout="column" layout-align="start"
     style="margin: 16px;">

    <div class="legend-popup" style="background: transparent; pointer-events: none;" layout="row" ng-init="transparentLegend = true"
         ng-class="{'transparent-legend':transparentLegend && !showLegend}">
        <md-button flex style="pointer-events: auto; width: 36px; height: 40px;" md-theme="{{themePrimaryButtons}}" ng-init="showLegend = false" ng-click="showLegend = !showLegend"
                   ng-mouseenter="transparentLegend = false" ng-mouseleave="transparentLegend = true"
                   class="md-primary md-raised md-icon-button">
            <md-icon md-theme="white" class="fa md-primary" ng-show="!showLegend" md-font-icon="fa-eye" title="Show Legend"></md-icon>
            <md-icon md-theme="white" class="fa md-primary" ng-show="showLegend" md-font-icon="fa-eye-slash" title="Hide Legend"></md-icon>
        </md-button>
        <div class="md-whiteframe-z3" layout="column" ng-show="showLegend" style="background: white; padding: 8px;">
            <div layout="row" layout-align="start center"><div class="color-patch nominal-child" title="Green"></div><span>Health - OK</span></div>
            <div layout="row" layout-align="start center"><div class="color-patch unknown-child" title="Grey"></div><span>Mode - Stop</span></div>
            <div layout="row" layout-align="start center"><div class="color-patch warn-child" title="Amber"></div><span>Mode - Inhibited</span></div>
            <div layout="row" layout-align="start center"><div class="color-patch stow-item" title="Blue"></div><span>Mode - Stow</span></div>
            <div layout="row" layout-align="start center"><div class="color-patch in-assigned-subarray-item" title="Light Green"></div><span>Assigned</span></div>
            <div layout="row" layout-align="start center"><div class="color-patch in-allocated-subarray-item" title="Light Blue"></div><span>Allocated</span></div>
            <div layout="row" layout-align="start center"><div class="color-patch in-maintenance-item" title="Purple"></div><span>In Maintenance</span></div>
            <div layout="row" layout-align="start center"><div class="color-patch error-item" title="Red"></div><span>In Error</span></div>
            <div layout="row" layout-align="start center"><div style="border: 1px solid #d3d3d3" class="color-patch" title="White"></div><span>Nothin to Report</span></div>
        </div>
    </div>

    <div layout="column" layout-align="center center">
        <div class="md-whiteframe-z1">
            <div layout="row">
                <span class="receptor-status-row-span"></span>

                <div ng-repeat="receptor in vm.receptorsData track by $index"
                     class="receptor-status-column-heading" layout="column" layout-align="center center"
                     ng-class="{'in-maintenance-item':receptor.in_maintenance}">
                    <span>{{receptor.name}}</span>
                </div>
            </div>
            <div>
                <div layout="row">
                    <div class="receptor-status-row-span" layout-align="start center" layout="row">
                        <span>Health - Device Status (AP)</span>
                    </div>
                    <div ng-repeat="receptor in vm.receptorsData track by $index"
                         class="receptor-status-column-heading nominal-item"
                         layout="column" layout-align="center center"
                         ng-class="{'error-item':receptor.ap_device_status.value !== 'ok'}">
                        <span>{{receptor.ap_device_status.value}}</span>
                    </div>
                </div>
                <div layout="row">
                    <div class="receptor-status-row-span" layout-align="start center" layout="row">
                        <span>Mode</span>
                    </div>
                    <div ng-repeat="receptor in vm.receptorsData track by $index"
                         class="receptor-status-column-heading nominal-item"
                         layout="column" layout-align="center center"
                         ng-class="{'stop-item': receptor.mode.value === 'STOP', 'stow-item': receptor.mode.value === 'STOW', 'error-item': receptor.windstow_active.value}">
                        <span ng-show="!receptor.windstow_active.value">{{receptor.mode.value}}</span>
                        <span ng-show="receptor.windstow_active.value">WINDSTOW</span>
                        <span style="width: 100%; text-align: center; border: 1px solid #333333;" class="inhibited-item" ng-show="receptor.inhibited.value">INHIBITED</span>
                        <span ng-show="receptor.lock.value" class="fa fa-asterisk on-target-span"
                              title="AP on Target"></span>
                    </div>
                </div>
                <div layout="row">
                    <div class="receptor-status-row-span" layout-align="start center" layout="row">
                        <span>Assigned/Allocated</span>
                    </div>
                    <div ng-repeat="receptor in vm.receptorsData track by $index"
                         class="receptor-status-column-heading"
                         layout="column" layout-align="center center"
                         ng-class="{'in-maintenance-item':receptor.in_maintenance && !(receptor.assignedSubarray || receptor.allocatedSubarray), 'in-assigned-subarray-item': receptor.assignedSubarray, 'in-allocated-subarray-item': receptor.allocatedSubarray}">
                        <!--leave vm.getReceptorSubarray(receptor) in there so that it gets called with every digest-->
                        <span ng-show="false">{{vm.getReceptorSubarray(receptor)}}</span>
                        <span ng-show="receptor.subarray">Sub-Array {{receptor.subarray}}</span>
                        <span ng-show="!receptor.subarray">Free</span>
                        <!--<span ng-show="receptor.allocation">SB {{receptor.allocation[1]}}</span>-->
                    </div>
                </div>
                <!--<div layout="row">-->
                    <!--<div class="receptor-status-row-span" layout-align="start center" layout="row">-->
                        <!--<span>QA1</span>-->
                    <!--</div>-->
                    <!--<div ng-repeat="receptor in vm.receptorsData track by $index"-->
                         <!--class="receptor-status-column-heading"-->
                         <!--layout="column" layout-align="center center">-->
                        <!--<span>{{receptor.qa1}}</span>-->
                    <!--</div>-->
                <!--</div>-->
            </div>
        </div>
    </div>

</div>
