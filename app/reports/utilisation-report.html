<div flex style="padding: 16px; min-width: 600px" ng-controller="UtilisationReportCtrl as vm" layout="column" ng-click="vm.showEndDatePicker = false; vm.showDawtePicker = false;">
    <md-toolbar md-theme="{{themePrimary}}" class="md-whiteframe-z1" layout="column">
        <div md-theme="{{themePrimaryButtons}}" class="md-toolbar-tools" layout="row" layout-align="start center"
            style="padding: 0">
            <span style="margin-left: 8px" flex>Report Parameters</span>
            <div layout="row" layout-align="start center" style="margin: 0 4px; font-size: 14px;">
                <div layout="row" layout-align="center center" style="min-width: 180px;">
                    <md-input-container flex md-no-float style="height: 36px; max-width: 135px; margin: 0; padding: 0;" title="Start Date 'yyyy-MM-dd HH:mm:ss'">
                        <input flex type="text" style="color: white" title="Start Date 'yyyy-MM-dd HH:mm:ss'" data-ng-model="vm.startDatetimeReadable"
                            placeholder="Start Date" />
                    </md-input-container>
                    <span></span>
                    <md-button class="md-icon-button" style="margin-left: 0; margin-top: 3px; width: 40px; height: 40px;"
                        ng-click="vm.showDatePicker = !vm.showDatePicker; vm.showEndDatePicker = false; $event.stopPropagation()">
                        <md-icon class="fa" md-font-icon="fa-calendar"></md-icon>
                    </md-button>

                    <datetimepicker id="datePickerMenu" class="datepickerMenu md-whiteframe-z3" ng-init="vm.showDatePicker = false"
                        style="position: absolute; right: 500px; top: 40px; color: #333333" ng-show="vm.showDatePicker"
                        data-ng-model="vm.startTime" ng-keypress="vm.showDatePicker = false" ng-click="$event.stopPropagation()"
                        data-on-set-time="vm.showDatePicker = false; vm.onStartTimeSet(vm.startTime)"></datetimepicker>
                </div>
                <div layout="row" layout-align="center center" style="min-width: 180px">
                    <md-input-container flex md-no-float style="height: 36px; max-width: 135px; margin: 0; padding: 0;">
                        <input flex type="text" style="color: white" data-ng-model="vm.endDatetimeReadable" placeholder="End Date"
                            title="End Date 'yyyy-MM-dd HH:mm:ss'" />
                    </md-input-container>
                    <span></span>
                    <md-button class="md-icon-button" style="margin-left: 0;width: 40px; height: 40px;" ng-click="vm.showEndDatePicker = !vm.showEndDatePicker; vm.showDatePicker = false; $event.stopPropagation()">
                        <md-icon class="fa" md-font-icon="fa-calendar"></md-icon>
                    </md-button>
                    <datetimepicker id="datePickerMenu" class="datepickerMenu md-whiteframe-z3" ng-init="vm.showEndDatePicker = false"
                        style="position: absolute; right: 335px; top: 40px; color: #333333" ng-show="vm.showEndDatePicker"
                        data-ng-model="vm.endTime" ng-keypress="vm.showEndDatePicker = false" ng-click="$event.stopPropagation()"
                        data-on-set-time="vm.showEndDatePicker = false; vm.onEndTimeSet(vm.endTime)"></datetimepicker>
                </div>
                <md-button class="add-tab md-primary md-raised" ng-click="vm.createReport()" ng-disabled="vm.creatingSubarrayReport || vm.creatingReceptorReport || vm.creatingScheduleReport"
                    style="margin-right: 0; min-width: 215px;">{{vm.creatingSubarrayReport || vm.creatingReceptorReport || vm.creatingScheduleReport? 'Creating Report...': 'Preview Utilisation Report'}}</md-button>
                <md-button ng-disabled="vm.receptorReportResults.length === 0 || vm.exportingPdf || vm.creatingSubarrayReport || vm.creatingReceptorReport || vm.creatingScheduleReport" class="add-tab md-primary md-raised"
                    ng-click="vm.exportPdf()" style="margin-right: 0;">{{vm.exportingPdf? 'Exporting PDF...' : 'Export as PDF'}}
                </md-button>
            </div>
        </div>
    </md-toolbar>
    <div flex style="overflow: auto" class="md-whiteframe-z1">
        <div layout="column" ng-show="vm.subarrayReportResults.length > 0" style="margin-bottom: 8px;">
            <i style="font-size: 22px; min-height: 42px" class="report-section-title-div">Subarray Sensors</i>
            <div class="report-section-sub-title-div" layout="row">
                <span style="width: 300px">Sensor</span>
                <span style="width: 125px" flex>Value</span>
                <span style="width: 80px; text-align: right; margin-left: 16px">Duration</span>
                <span style="width: 100px; text-align: right; margin-left: 16px">% of Total</span>
            </div>
            <div layout="column">
                <div ng-repeat="item in vm.subarrayReportResults | orderBy:sensorName track by $index"
                    layout="row" class="report-item text-overflow-ellipsis" ng-class="{'light-grey-background-03': $index % 2 == 1}">
                    <span class="fixed-width-300" title="{{item.sensorName}}">{{item.sensorName}}</span>
                    <span flex style="min-width: 200px" title="{{item.value}}">{{item.value}}</span>
                    <span style="width: 80px; text-align: right; margin-left: 16px">{{item.duration}}</span>
                    <span style="width: 100px; text-align: right; margin-left: 16px">{{item.percentageOfTotal}}</span>
                </div>
            </div>
        </div>
        <div layout="column" ng-show="vm.receptorReportResults.length > 0" style="margin-bottom: 8px;">
            <i style="font-size: 22px; min-height: 42px" class="report-section-title-div">Resource Utilisation</i>
            <div layout="column" ng-repeat="subarray in $root.objectKeys(vm.poolResourcesAssignedToSubarraysDurations) | orderBy:subarray track by $index">
                <div class="report-section-sub-title-div" layout="row">
                    <span flex>Assigned to {{subarray}}</span>
                    <span ng-show="$index === 0" style="width: 80px; text-align: right; margin-left: 16px">Duration</span>
                    <span ng-show="$index === 0" style="width: 100px; text-align: right; margin-left: 16px">% of Total</span>
                </div>
                <div layout="column">
                    <div ng-repeat="key in $root.objectKeys(vm.poolResourcesAssignedToSubarraysDurations[subarray]) | orderBy:key track by $index"
                        layout="row" class="report-item text-overflow-ellipsis" ng-class="{'light-grey-background-03': $index % 2 == 1}">
                        <span flex>{{key}}</span>
                        <span style="width: 80px; text-align: right; margin-left: 16px">{{vm.poolResourcesAssignedToSubarraysDurations[subarray][key].duration}}</span>
                        <span style="width: 100px; text-align: right; margin-left: 16px">{{vm.poolResourcesAssignedToSubarraysDurations[subarray][key].percentageOfTotal}}</span>
                    </div>
                    <div class="report-item" ng-show="$root.objectKeys(vm.poolResourcesAssignedToSubarraysDurations[subarray]).length === 0">
                        <i>None</i>
                    </div>
                </div>
            </div>
            <div class="report-section-sub-title-div" layout="row">
                <span flex>Free</span>
            </div>
            <div layout="column">
                <div ng-repeat="key in $root.objectKeys(vm.poolResourcesFreeDurations) | orderBy:key track by $index"
                    layout="row" class="report-item text-overflow-ellipsis" ng-class="{'light-grey-background-03': $index % 2 == 1}">
                    <span flex>{{key}}</span>
                    <span style="width: 80px; text-align: right; margin-left: 16px">{{vm.poolResourcesFreeDurations[key].duration}}</span>
                    <span style="width: 100px; text-align: right; margin-left: 16px">{{vm.poolResourcesFreeDurations[key].percentageOfTotal}}</span>
                </div>
            </div>
            <div class="report-section-sub-title-div" layout="row">
                <span flex>Faulty</span>
            </div>
            <div layout="column">
                <div ng-repeat="key in $root.objectKeys(vm.poolResourcesFaultyDurations) | orderBy:key track by $index"
                    layout="row" class="report-item text-overflow-ellipsis" ng-class="{'light-grey-background-03': $index % 2 == 1}">
                    <span flex>{{key}}</span>
                    <span style="width: 80px; text-align: right; margin-left: 16px">{{vm.poolResourcesFaultyDurations[key].duration}}</span>
                    <span style="width: 100px; text-align: right; margin-left: 16px">{{vm.poolResourcesFaultyDurations[key].percentageOfTotal}}</span>
                </div>
            </div>
            <div class="report-section-sub-title-div" layout="row">
                <span flex>In Maintenance</span>
            </div>
            <div layout="column">
                <div ng-repeat="key in $root.objectKeys(vm.poolResourcesMaintenanceDurations) | orderBy:key track by $index"
                    layout="row" class="report-item text-overflow-ellipsis" ng-class="{'light-grey-background-03': $index % 2 == 1}">
                    <span flex>{{key}}</span>
                    <span style="width: 80px; text-align: right; margin-left: 16px">{{vm.poolResourcesMaintenanceDurations[key].duration}}</span>
                    <span style="width: 100px; text-align: right; margin-left: 16px">{{vm.poolResourcesMaintenanceDurations[key].percentageOfTotal}}</span>
                </div>
            </div>
            <div layout="column" ng-show="vm.interlockReceptorReportResults.length > 0" style="margin-bottom: 8px;">
                <i style="font-size: 22px; min-height: 42px" class="report-section-title-div">Receptor Modes</i>
                <div class="report-section-sub-title-div" layout="row">
                    <span style="width: 300px">Sensor</span>
                    <span style="width: 125px" flex>Value</span>
                    <span style="width: 80px; text-align: right; margin-left: 16px">Duration</span>
                    <span style="width: 100px; text-align: right; margin-left: 16px">% of Total</span>
                </div>
                <div layout="column">
                    <div ng-repeat="item in vm.receptorModeDurations | orderBy:sensorName track by $index"
                        layout="row" class="report-item text-overflow-ellipsis" ng-class="{'light-grey-background-03': $index % 2 == 1}">
                        <span class="fixed-width-300" title="{{item.sensorName}}">{{item.sensorName}}</span>
                        <span flex style="min-width: 200px" title="{{item.value}}">{{item.value}}</span>
                        <span style="width: 80px; text-align: right; margin-left: 16px">{{item.duration}}</span>
                        <span style="width: 100px; text-align: right; margin-left: 16px">{{item.percentageOfTotal}}</span>
                    </div>
                </div>
            </div>
        </div>
        <div layout="column" ng-show="vm.interlockReceptorReportResults.length > 0" style="margin-bottom: 8px;">
            <i style="font-size: 22px; min-height: 42px" class="report-section-title-div">Interlock/Windstow</i>
            <div class="report-section-sub-title-div" layout="row">
                <span style="width: 300px">Sensor</span>
                <span style="width: 125px" flex>Value</span>
                <span style="width: 80px; text-align: right; margin-left: 16px">Duration</span>
                <span style="width: 100px; text-align: right; margin-left: 16px">% of Total</span>
            </div>
            <div layout="column">
                <div ng-repeat="item in vm.interlockReceptorReportResults | orderBy:sensorName track by $index"
                    layout="row" class="report-item text-overflow-ellipsis" ng-class="{'light-grey-background-03': $index % 2 == 1}">
                    <span class="fixed-width-300" title="{{item.sensorName}}">{{item.sensorName}}</span>
                    <span flex style="min-width: 200px" title="{{item.value}}">{{item.value}}</span>
                    <span style="width: 80px; text-align: right; margin-left: 16px">{{item.duration}}</span>
                    <span style="width: 100px; text-align: right; margin-left: 16px">{{item.percentageOfTotal}}</span>
                </div>
            </div>
        </div>
        <div layout="column" ng-show="vm.scheduleReportResults.length > 0"  style="margin-bottom: 8px;">
            <i style="font-size: 22px; min-height: 42px" class="report-section-title-div">Active Schedule Blocks</i>
            <div class="report-section-sub-title-div" layout="row">
                <span style="width: 300px">Sensor</span>
                <span style="width: 125px" flex>Value</span>
                <span style="width: 80px; text-align: right; margin-left: 16px">Duration</span>
                <span style="width: 100px; text-align: right; margin-left: 16px">% of Total</span>
            </div>
            <div layout="column">
                <div ng-repeat="item in vm.scheduleReportResults | orderBy:sensorName track by $index"
                    layout="row" class="report-item text-overflow-ellipsis" ng-class="{'light-grey-background-03': $index % 2 == 1}">
                    <span class="fixed-width-300" title="{{item.sensorName}}">{{item.sensorName}}</span>
                    <span flex style="min-width: 200px" title="{{item.value}}">{{item.value}}</span>
                    <span style="width: 80px; text-align: right; margin-left: 16px">{{item.duration}}</span>
                    <span style="width: 100px; text-align: right; margin-left: 16px">{{item.percentageOfTotal}}</span>
                </div>
            </div>
        </div>
        <div layout="column" ng-show="vm.scheduleReportResults.length > 0">
            <i style="font-size: 22px; min-height: 42px" class="report-section-title-div">Active Schedule Block Details</i>
            <div class="report-section-sub-title-div" layout="row">
                <span style="width: 120px">Id Code</span>
                <span style="width: 120px">Owner</span>
                <span style="width: 125px" flex>Description</span>
                <span style="width: 100px; text-align: right; margin-left: 16px">State</span>
                <span style="width: 100px; text-align: right; margin-left: 16px">Outcome</span>
                <span style="width: 100px; text-align: right; margin-left: 16px">Duration</span>
                <span style="width: 100px; text-align: right; margin-left: 16px">% of Total</span>
            </div>
            <div layout="column">
                <div ng-repeat="sb in vm.SBDetails | orderBy:id_code track by $index"
                    layout="row" class="report-item text-overflow-ellipsis" ng-class="{'light-grey-background-03': $index % 2 == 1}">
                    <span style="width: 120px">{{sb.id_code}}</span>
                    <span style="width: 120px">{{sb.owner}}</span>
                    <span flex style="min-width: 200px" title="{{sb.description}}">{{sb.description}}</span>
                    <span style="width: 100px; text-align: right; margin-left: 16px">{{sb.state}}</span>
                    <span style="width: 100px; text-align: right; margin-left: 16px">{{sb.outcome}}</span>
                    <span style="width: 100px; text-align: right; margin-left: 16px">{{sb.duration}}</span>
                    <span style="width: 100px; text-align: right; margin-left: 16px">{{sb.percentageOfTotal}}</span>
                </div>
            </div>
        </div>
    </div>
</div>
