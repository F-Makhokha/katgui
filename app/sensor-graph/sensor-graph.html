<div layout="row" ng-controller="SensorGraphCtrl as vm" md-theme="{{themePrimary}}" flex>

    <div layout="column" style="margin: 8px; min-width: 366px; max-width: 366px; min-height: 100%;"
         ng-click="vm.showDatePicker = false;vm.showEndDatePicker = false;">
        <md-toolbar layout="row" class="md-whiteframe-z1 md-toolbar-tools-medium">
            <span flex>Sensor Graph Tools</span>
            <md-menu md-theme="{{themePrimaryButtons}}" style="padding: 0">
                <md-button class="md-icon-button inline-action-button" ng-click="$mdOpenMenu()" style="margin:0">
                    <md-icon class="fa" md-font-icon="fa-ellipsis-v"></md-icon>
                </md-button>
                <md-menu-content width="4" style="padding-left: 16px;">
                    <md-menu-item>
                        <md-checkbox class="md-primary" ng-model="vm.showRelativeTime" ng-click="">
                            Show Relative Date-Time Picker
                        </md-checkbox>
                    </md-menu-item>
                </md-menu-content>
            </md-menu>
        </md-toolbar>
        <div flex class="md-whiteframe-z1" layout="column" layout-align="start center"
             md-theme="{{themePrimaryButtons}}" style="overflow: auto;">

            <datetimepicker id="datePickerMenu" class="datepickerMenu md-whiteframe-z1"
                            ng-init="vm.showDatePicker = false"
                            style="position: absolute; left:23px; top: 46px; color: #333333;"
                            ng-show="vm.showDatePicker" data-ng-model="vm.sensorStartDatetime"
                            ng-keypress="vm.showDatePicker = false"
                            ng-click="$event.stopPropagation()"
                            data-on-set-time="vm.showDatePicker = false; vm.onTimeSet(newDate)"></datetimepicker>

            <datetimepicker id="enddatePickerMenu" class="datepickerMenu md-whiteframe-z1"
                            ng-init="vm.showEndDatePicker = false"
                            style="position: absolute; left:23px; top: 80px; color: #333333;"
                            ng-show="vm.showEndDatePicker" data-ng-model="vm.sensorEndDatetime"
                            ng-keypress="vm.showEndDatePicker = false"
                            ng-click="$event.stopPropagation()"
                            data-on-set-time="vm.showEndDatePicker = false; vm.onEndTimeSet(newDate)"></datetimepicker>

            <div layout="row">
                <md-input-container md-no-float style="margin-top: 3px; padding: 0; width: 135px;">
                    <input type="text" ng-change="vm.startTimeChange()" class=""
                           ng-model="vm.sensorStartDateReadable" placeholder="Start Date"
                           ng-class="{'input-error':vm.dateTimeError}" title="End Date 'HH:mm:ss yyyy-MM-dd'"
                           ng-click="$event.stopPropagation()"/>
                </md-input-container>
                <md-button class="md-icon-button" style="margin-left: 0px; margin-top: 3px; width: 40px; height: 40px;"
                           ng-click="vm.showDatePicker = !vm.showDatePicker; vm.showEndDatePicker = false; $event.stopPropagation()">
                    <md-icon class="fa" md-font-icon="fa-calendar"></md-icon>
                </md-button>
            </div>

            <div layout="row" layout="center center" style="margin-top: -10px;" ng-show="vm.showRelativeTime">
                <md-switch ng-init="vm.plusMinus = false" class="md-primary" ng-model="vm.plusMinus"
                           style="font-size: 34px; min-width: 65px; margin-right: -10px; margin-top: 12px">
                    {{vm.plusMinus? '+' : '-'}}
                </md-switch>
                <md-input-container md-no-float style="padding: 0; vertical-align: middle">
                    <input ng-init="vm.unitLength = 1" type="number" min="1" max="999"
                           style="font-size: 16px; background: transparent; width: 45px; text-align: end; max-height: 30px; margin-top:21px;"
                           placeholder="" ng-model="vm.unitLength" title="Range Unit Length">
                </md-input-container>

                <md-select md-theme="{{themePrimaryButtons}}" ng-init="vm.unitType = 'h'" ng-model="vm.unitType"
                           style="min-width: 105px;">
                    <md-option value="s">Second(s)</md-option>
                    <md-option value="m">Minute(s)</md-option>
                    <md-option value="h">Hour(s)</md-option>
                    <md-option value="d">Day(s)</md-option>
                </md-select>
            </div>

            <div layout="row" layout="center center" style="margin-top: -10px;" ng-show="!vm.showRelativeTime">
                <md-input-container md-no-float style="margin-top: 3px; padding: 0; width: 135px;">
                    <input type="text" ng-change="vm.endTimeChange()" class=""
                           ng-model="vm.sensorEndDateReadable" placeholder="End Date"
                           ng-class="{'input-error':vm.endDateTimeError}" title="Start Date 'HH:mm:ss yyyy-MM-dd'"
                           ng-click="$event.stopPropagation()"/>
                </md-input-container>
                <md-button class="md-icon-button" style="margin-left: 0px; margin-top: 3px; width: 40px; height: 40px;"
                           ng-click="vm.showEndDatePicker = !vm.showEndDatePicker; vm.showDatePicker = false; $event.stopPropagation()">
                    <md-icon class="fa" md-font-icon="fa-calendar"></md-icon>
                </md-button>
            </div>

            <div layout="row" layout-align="center center" style="margin-left: 16px; margin-right:16px; width: 130px;">
                <!--<span style="margin-right: 8px;">Sensor Type:</span>-->
                <md-select flex md-theme="{{themePrimaryButtons}}" ng-init="vm.sensorType = 'numeric'"
                           ng-model="vm.sensorType" style="padding: 8px"
                           title="Sensor Type" ng-change="vm.sensorTypeChanged()">
                    <md-option value="numeric">Numeric</md-option>
                    <!--<md-option value="text">Text</md-option>-->
                    <md-option value="discrete">Discrete</md-option>
                </md-select>
            </div>
            <div layout="row" layout-align="center center" ng-show="vm.sensorType === 'numeric'">
                <span style="margin-right: 8px;">Interval:</span>
                <md-select md-theme="{{themePrimaryButtons}}" ng-init="vm.intervalNum = 1" ng-model="vm.intervalNum"
                           style="margin: 0; padding: 8px">
                    <md-option value="1">1</md-option>
                    <md-option value="2">2</md-option>
                    <md-option value="5">5</md-option>
                    <md-option value="10">10</md-option>
                    <md-option value="15">15</md-option>
                    <md-option value="30">30</md-option>
                    <md-option value="60">60</md-option>
                    <md-option value="100">100</md-option>
                </md-select>
                <md-select md-theme="{{themePrimaryButtons}}" ng-init="vm.intervalType = 'm'" ng-model="vm.intervalType"
                           style="margin: 0; padding: 8px">
                    <md-option value="s">Second(s)</md-option>
                    <md-option value="m">Minute(s)</md-option>
                    <md-option value="h">Hour(s)</md-option>
                    <md-option value="d">Day(s)</md-option>
                </md-select>
            </div>

            <!--<md-input-container md-no-float class="sensor-search-input">-->
            <!--<input type="text" ng-change="vm.validateSearchInputLength(vm.sensorRegexStr)"-->
            <!--placeholder="Search for sensors by regex..." ng-model="vm.sensorRegexStr"-->
            <!--ng-keypress="vm.findSensorDataFromRegex(vm.sensorRegexStr, $event)"-->
            <!--ng-class="{'input-error':vm.sensorSearchFieldLengthError}" title="Start Typing to Search"/>-->
            <!--</md-input-container>-->

            <md-input-container md-no-float class="sensor-search-input">
                <input type="text" ng-change="vm.validateSearchInputLength(vm.sensorSearchStr)"
                       placeholder="Search for sensors..." ng-model="vm.sensorSearchStr"
                       ng-keypress="vm.findSensorNames(vm.sensorSearchStr, $event)"
                       ng-class="{'input-error':vm.sensorSearchFieldLengthError}"
                       title="Type a sensor name expression and press enter. E.g. *wind*"/>
            </md-input-container>
            <div class="sensor-search-name-list unselectable md-whiteframe-z1">
                <div class="sensor-search-result-item" ng-repeat="sensor in vm.sensorSearchNames track by $index"
                     ng-click="vm.searchSensorClicked(sensor);">
                    <span>{{sensor.name}}</span>
                </div>
                <div layout="row" layout-align="center center" class="search-loading-overlay unselectable"
                     ng-if="vm.waitingForSearchResult">
                    <div class="spinner">
                        <div class="double-bounce1"></div>
                        <div class="double-bounce2"></div>
                    </div>
                </div>
            </div>

            <div style="width: 100%; margin-top: 4px;" layout="row" layout-align="center center">
                <span ng-show="vm.sensorSearchNames.length === 1000" title="Refine the search to see more sensors"
                      class="fa fa-warning"></span>
                <span ng-show="vm.sensorSearchNames.length > 1" style="margin-left: 4px;">Displaying {{vm.sensorSearchNames.length}} results.</span>
                <span ng-show="vm.sensorSearchNames.length === 1" style="margin-left: 4px;">There is 1 result.</span>
                <span ng-show="vm.sensorSearchNames.length === 0" style="margin-left: 4px;">There are no results.</span>
            </div>

            <div layout="column" style="width: 100%;">
                <md-checkbox class="md-primary" ng-model="vm.liveData" ng-change="vm.liveDataChanged()">
                    Include Live Data
                </md-checkbox>
            </div>
        </div>
    </div>

    <div flex layout="column" class="md-whiteframe-z1" style="margin: 8px;">
        <md-toolbar layout="row" layout-align="end center" class="md-whiteframe-z1 ">
            <div flex layout="row" layout-align="center center" md-theme="{{themePrimaryButtons}}"
                 class="md-toolbar-tools-medium">
                <md-chips flex class="custom-chips" ng-model="vm.sensorNames" readonly="true">
                    <md-chip-template title="{{$chip.name}}" ng-mouseenter="vm.setLineStrokeWidth($chip.name)"
                                      ng-mouseleave="vm.removeLineStrokeWidth($chip.name)">
                        <span class="{{$chip.name}}">
                          <strong>{{$chip.name}}</strong>
                        </span>
                    </md-chip-template>
                    <button md-chip-remove ng-click="vm.chipRemovePressed($chip)" class="md-primary sensor-name-chip">
                        <md-icon md-font-icon="fa-close" class="fa"></md-icon>
                    </button>
                </md-chips>
            </div>
        </md-toolbar>
        <multi-line-chart flex data="vm.sensorData" redraw-function="vm.redrawChart" clear-function="vm.clearChart"
                          remove-sensor-function="vm.removeSensorLine" y-max="vm.yAxisMaxValue"
                          y-min="vm.yAxisMinValue" mouse-over-tooltip="true"></multi-line-chart>
        <div layout="row" class="floating-chart-actions">
            <!--<md-button class="md-icon-button"-->
            <!--ng-click="vm.showHelp($event)">-->
            <!--<md-icon class="fa" md-font-icon="fa-question"></md-icon>-->
            <!--</md-button>-->
            <md-button class="md-icon-button"
                       ng-click="vm.clearData()" title="Clear Data">
                <md-icon class="fa" md-font-icon="fa-remove"></md-icon>
            </md-button>
            <md-menu md-theme="{{themePrimaryButtons}}" style="padding: 0">
                <md-button class="md-icon-button" ng-click="$mdOpenMenu()">
                    <md-icon class="fa" md-font-icon="fa-ellipsis-v"></md-icon>
                </md-button>
                <md-menu-content width="4" style="padding-left: 16px;">
                    <md-menu-item>
                        <md-checkbox class="md-primary" ng-model="vm.showGridLines" ng-change="vm.showOptionsChanged()"
                                     ng-click="$event.stopPropagation()">
                            Show Grid Lines
                        </md-checkbox>
                    </md-menu-item>
                    <md-menu-item>
                        <md-checkbox class="md-primary" ng-model="vm.showContextZoom"
                                     ng-change="vm.showOptionsChanged()" ng-click="$event.stopPropagation()">
                            Show Context Zoom
                        </md-checkbox>
                    </md-menu-item>
                    <md-menu-item>
                        <md-checkbox class="md-primary" ng-model="vm.useFixedYAxis" ng-change="vm.showOptionsChanged()"
                                     ng-click="$event.stopPropagation()">
                            Use Fixed Y Axis Values
                        </md-checkbox>
                    </md-menu-item>
                    <md-menu-item ng-if="vm.useFixedYAxis">
                        <div md-theme="{{themePrimaryButtons}}" layout="row" layout-align="start center" ng-click="$event.stopPropagation()"
                             style="margin-left: 8px; margin-right: 8px; margin-bottom: 8px;">
                            <label style="width: 43px; font-weight: normal; margin-top: 4px;">Y Min:</label>
                            <md-input-container md-no-float style="margin-left: 8px;text-align: start; padding: 0px;"
                                                class="md-primary" title="Set the desired Y-Axis Minimum Value">
                                <input flex style="" placeholder="Minimum" ng-model="vm.yAxisMinValue"
                                       ng-change="vm.showOptionsChanged()" type="number"
                                       ng-model-options="{ debounce: 300 }">
                            </md-input-container>
                        </div>
                    </md-menu-item>
                    <md-menu-item ng-if="vm.useFixedYAxis">
                        <div md-theme="{{themePrimaryButtons}}" layout="row" layout-align="start center" ng-click="$event.stopPropagation()"
                             style="margin-left: 8px; margin-right: 8px; margin-bottom: 8px;">
                            <label style="width: 43px; font-weight: normal; margin-top: 4px;">Y Max:</label>
                            <md-input-container md-no-float style="margin-left: 8px;text-align: start; padding: 0px;"
                                                class="md-primary" title="Set the desired Y-Axis Maximum Value">
                                <input flex style="" placeholder="Maximum" ng-model="vm.yAxisMaxValue"
                                       ng-change="vm.showOptionsChanged()" type="number"
                                       ng-model-options="{ debounce: 300 }">
                            </md-input-container>
                        </div>
                    </md-menu-item>
                </md-menu-content>
            </md-menu>
        </div>
    </div>
</div>
